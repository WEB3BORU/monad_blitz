# Crypto Graves Smart Contracts - Security Audit Report

## 개요
Crypto Graves 프로젝트의 스마트 컨트랙트 보안 오딧 리포트입니다.

## 컨트랙트 정보
- **CryptoGravesNFT.sol**: NFT 민팅 컨트랙트
- **CryptoGravesToken.sol**: 밈토큰 생성 컨트랙트
- **MemeToken.sol**: 개별 밈토큰 컨트랙트

## 보안 기능 구현

### ✅ 구현된 보안 기능

#### 1. 접근 제어 (Access Control)
- **Ownable 패턴**: 관리자만 민팅 조건 변경 가능
- **지갑 검증**: `verifiedWallets` 매핑으로 검증된 지갑만 민팅 가능
- **일괄 검증**: `batchVerifyWallets` 함수로 효율적인 검증

#### 2. 재진입 공격 방지 (Reentrancy Protection)
- **ReentrancyGuard**: 모든 민팅 함수에 `nonReentrant` 모디파이어 적용
- **안전한 상태 변경**: 상태 변경 후 외부 호출

#### 3. 일시정지 기능 (Pausable)
- **긴급 상황 대응**: `pause()` / `unpause()` 함수로 컨트랙트 일시정지 가능
- **전체 기능 제어**: 민팅과 전송 모두 일시정지 가능

#### 4. 입력값 검증 (Input Validation)
```solidity
// 민팅 조건
require(lossRate >= MIN_LOSS_RATE, "Loss rate too low");        // 최소 5%
require(lossRate <= MAX_LOSS_RATE, "Loss rate too high");       // 최대 100%
require(lossAmount >= MIN_LOSS_AMOUNT, "Loss amount too low");  // 최소 100 MON

// 입력값 길이 검증
require(bytes(ticker).length > 0 && bytes(ticker).length <= 10, "Invalid ticker length");
require(bytes(walletAddress).length == 42, "Invalid wallet address length");
```

#### 5. 중복 방지 (Duplicate Prevention)
- **고유성 보장**: 같은 지갑 주소와 티커 조합은 하나만 생성 가능
- **매핑 활용**: `walletTickerToTokenId` 매핑으로 중복 체크

#### 6. 가스 최적화 (Gas Optimization)
- **상수 사용**: `constant` 키워드로 가스 비용 절약
- **효율적인 매핑**: 필요한 데이터만 저장

## 민팅 조건

### NFT 민팅 조건
1. **지갑 검증**: 백엔드에서 검증된 지갑만 민팅 가능
2. **손실률**: 최소 5% (500), 최대 100% (10000)
3. **손실 금액**: 최소 100 MON
4. **중복 방지**: 같은 지갑의 같은 티커는 하나만

### 밈토큰 생성 조건
1. **지갑 검증**: 백엔드에서 검증된 지갑만 생성 가능
2. **손실률**: 최소 5% (500), 최대 100% (10000)
3. **손실 금액**: 최소 100 MON
4. **총 공급량**: 1 ~ 10억 토큰
5. **토큰명/심볼**: 적절한 길이 제한

## 잠재적 위험 요소 및 대응책

### 🔴 높은 위험도

#### 1. 관리자 권한 남용
- **위험**: 관리자가 모든 지갑을 검증/해제 가능
- **대응**: 다중 서명 또는 DAO 구조 고려

#### 2. 가스비 공격
- **위험**: 높은 가스비로 다른 사용자 민팅 방해
- **대응**: 가스비 제한 또는 배치 처리 고려

### 🟡 중간 위험도

#### 1. 입력값 조작
- **위험**: 백엔드에서 잘못된 데이터 전송
- **대응**: 온체인 검증 강화, 오라클 사용 고려

#### 2. 메타데이터 조작
- **위험**: NFT 메타데이터 URI 조작
- **대응**: IPFS 사용, 해시 검증 추가

### 🟢 낮은 위험도

#### 1. 가스비 변동
- **위험**: 네트워크 혼잡으로 가스비 상승
- **대응**: 가스비 추정 기능 제공

## 권장사항

### 즉시 적용
1. **다중 서명**: 관리자 권한을 다중 서명으로 변경
2. **이벤트 로깅**: 모든 중요 작업에 이벤트 추가
3. **테스트 강화**: 모든 엣지 케이스 테스트

### 장기 적용
1. **오라클 통합**: 실제 손실 데이터 검증을 위한 오라클
2. **DAO 구조**: 커뮤니티 거버넌스 도입
3. **레이어2 확장**: 가스비 절약을 위한 L2 솔루션

## 테스트 시나리오

### 성공 케이스
- ✅ 검증된 지갑으로 정상 민팅
- ✅ 조건을 만족하는 손실 데이터로 민팅
- ✅ 관리자 권한으로 지갑 검증

### 실패 케이스
- ❌ 검증되지 않은 지갑으로 민팅 시도
- ❌ 조건을 만족하지 않는 데이터로 민팅 시도
- ❌ 중복 민팅 시도
- ❌ 권한 없는 사용자의 관리자 기능 호출

## 결론

현재 컨트랙트는 기본적인 보안 기능이 잘 구현되어 있습니다. 주요 위험 요소는 관리자 권한 남용과 가스비 공격이며, 이에 대한 추가 보안 조치가 권장됩니다.

**보안 등급: B+ (안전함)** 